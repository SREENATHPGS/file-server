<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='shortcut icon' type='image/x-icon' href='./favicon.ico' />
    
    
    <style>
        @font-face {
            font-family: 'fira_sansregular';
            src: url("./assets/fonts/webfont_firasans_Regular/firasans-regular-webfont.woff2") format('woff2'),
            url("./assets/fonts/webfont_firasans_Regular/firasans-regular-webfont.woff") format('woff');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" href="./assets/css/form_style.css">
    <link href="./assets/css/vendor/bootstrap/bootstrap.min.css" rel="stylesheet">
    <title>Document</title>
</head>
<body>
    <link href="./assets/css/vendor/boxicons/min/boxicons.min.css" rel="stylesheet" />
    
    
    <div id = "file_upload_modal" class = "modal">
        <div>
            <div class="custom_container">
                <div style="text-align: center;">
                    <h3 class="custom_font">Upload files to drive.</h3>
                </div>
            </div>
            <div class="custom_container">
                <!-- Login Form Start -->
                <form id="uploadForm" method=post enctype=multipart/form-data>
                    <div class="c_row">
                        <div class="col_25">
                            <label class="custom_font" for="upload_file">Select a file</label>
                        </div>
                        <div class="col_75">
                            <input class="loginInput" type="file" id="upload_file" name="upload_file" placeholder="Select a file" multiple>
                        </div>
                    </div>
                    <div class="c_row">
                        <input class="loginInput" type="submit" value="Upload">
                    </div>            
                </form>
                <!-- Login Foem End -->
            </div>
        </div>
    </div>
    
    <div id = "login_container" class="contact_us_main_container">
        <div class="custom_container">
            <div id = "logoWrapper">
                <img src="./assets/images/logo250.png" alt="Thunder Share" style="height:200px; display: block; margin-left: auto; margin-right: auto;">
            </div>
            <div style="text-align: center;">
                <h3 class="custom_font">Encrypt and Store Drive</h3>
            </div>
        </div>
        <div class="custom_container">
            <p id="login_message"></p>
            <div class="c_row">
                <div style="display: flex; flex-direction: row;">
                    <div class = "c_row" style="width: 50%;" id = "fbPagesList"></div>
                    <div class = "c_row" style="width: 50%;" id = "igPagesList"></div>
                </div>
            </div>
            <!-- Login Form Start -->
            <form id="loginForm">
                <div class="c_row">
                    <div class="col_25">
                        <label class="custom_font" for="username">Username</label>
                    </div>
                    <div class="col_75">
                        <input class="loginInput" type="text" id="username" name="username" placeholder="Enter the username." required>
                    </div>
                </div>
                <div class="c_row">
                    <div class="col_25">
                        <label for="Password">Password</label>
                    </div>
                    <div class="col_75">
                        <input class="loginInput" type="password" id="password" name="Password" placeholder="Enter the Password" required>
                    </div>
                </div>
                
                <div class="c_row">
                    <input class="loginInput" type="button" onClick=login() value="Login">
                </div>            
            </form>
            <!-- Login Foem End -->
            <form id="schedulerForm">
                <div class="c_row">
                    <div class="col_25">
                        <label for="image_url">Image URL</label>
                    </div>
                    <div class="col_75">
                        <input class="loginInput" type="text" id="image_url" name="image_url" placeholder="Enter image url to be posted." required>
                    </div>
                </div>
                <div class="c_row">
                    <div class="col_25">
                        <label for="schedule_date">Schedule Date</label>
                    </div>
                    <div class="col_75">
                        <input class="loginInput" type="datetime-local" id="schedule_date" name="schedule_date" placeholder="yyyy-mm-dd:hh:mm:ss:+zh:zm" required>
                    </div>
                </div>
                <div class="c_row">
                    <div class="col_25">
                        <label for="media_story">Media Story</label>
                    </div>
                    <div class="col_75">
                        <input class="loginInput" type="text" id="media_story" name="media_story" placeholder="hashtags, stories" required>
                    </div>
                </div>
                
                <!-- <div class="c_row">
                    <div class="col_25">
                        <label for="scope">What is your enquiry about?.</label>
                    </div>
                    <div class="col_75">
                        <datalist id="scopeDataList" class="loginInput" name="scope">
                            <option value="Website">Personal, Corporate, Team, Club websites.</option>
                            <option value="Hosting">Hosting - Bulk, R&D, Demo</option>
                            <option value="Web-App">Web Application Development</option>
                            <option value="Android-App">Android Application Developtment</option>
                            <option value="Hybrid-App">Hybrid Application [Ionic] Development</option>
                            <option value="DevOps">DevOps Workflow Design/Implementation</option>
                            <option value="Consultation">Consultation</option>
                            <option value="Collaboration">Let's work togather</option>
                            <option value="Build Feature">Want to build a feature for your application? (Eg. REST API development)</option>
                        </datalist>
                        <input class="loginInput" type="text" autoComplete="on" list="scopeDataList" id="scope" name="scope">
                    </div>
                </div> -->
                
                <div class="c_row">
                    <input class="loginInput" type="button" onClick=place_schedule() id="submitButton" value="Schedule">
                </div>
                
                <div class="c_row fb_bg">
                    <input class="loginInput" type="button" onClick=fblogin() id="fb_login_button" value="FB Login">
                    <input class="loginInput" type="button" onClick=fblogout() id="fb_logout_button" value="FB Logout">
                </div>
                <div class="c_row">
                    <input class="loginInput" type="button" onClick=logout() id="app_logout_button" value="Logout">
                    <input class="loginInput" type="button" onClick=viewSchedules() id="view_schedules_button" value="View Schedules">
                </div>
            </form>
        </div>
    </div>
    
    <div id = "file_explorer_container" class="container">
        <div class="row">
            <div class="col-12 col-lg-3">
                <div class="card">
                    <div class="card-body">
                        <h4 class="my-3">My Drive</h4>
                        <h5 class="my-3">Hi!, <span id="hi_username"></span></h5>
                        <div class="d-grid">
                            <a onclick=logout() class="btn btn-primary">Logout</a>
                        </div>
                    </div>
                </div>
                <div class="card">
                </div>
            </div>
            <div class="col-12 col-lg-9">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div>
                                <h5 class="mb-0">All Files</h5>
                            </div>
                            <div class="ms-auto">
                                <a onclick=uploadFiles() class="btn btn-sm btn-outline-secondary">Upload</a>
                            </div>
                        </div>
                        <div class="table-responsive mt-3">
                            <table class="table table-striped table-hover table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>Name <i class="bx bx-up-arrow-alt ms-2"></i>
                                        </th>
                                        <th>Members</th>
                                        <th>Last Modified</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file-pdf me-2 font-24 text-danger"></i>
                                                </div>
                                                <div class="font-weight-bold text-danger">Competitor Analysis Template</div>
                                            </div>
                                        </td>
                                        <td>Only you</td>
                                        <td>Sep 3, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file me-2 font-24 text-primary"></i>
                                                </div>
                                                <div class="font-weight-bold text-primary">How to Create a Case Study</div>
                                            </div>
                                        </td>
                                        <td>3 members</td>
                                        <td>Jun 12, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file me-2 font-24 text-primary"></i>
                                                </div>
                                                <div class="font-weight-bold text-primary">Landing Page Structure</div>
                                            </div>
                                        </td>
                                        <td>10 members</td>
                                        <td>Jul 17, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file-pdf me-2 font-24 text-danger"></i>
                                                </div>
                                                <div class="font-weight-bold text-danger">Meeting Report</div>
                                            </div>
                                        </td>
                                        <td>5 members</td>
                                        <td>Aug 28, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file me-2 font-24 text-primary"></i>
                                                </div>
                                                <div class="font-weight-bold text-primary">Project Documents</div>
                                            </div>
                                        </td>
                                        <td>Only you</td>
                                        <td>Aug 17, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file-doc me-2 font-24 text-success"></i>
                                                </div>
                                                <div class="font-weight-bold text-success">Review Checklist Template</div>
                                            </div>
                                        </td>
                                        <td>7 members</td>
                                        <td>Sep 8, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file me-2 font-24 text-primary"></i>
                                                </div>
                                                <div class="font-weight-bold text-primary">How to Create a Case Study</div>
                                            </div>
                                        </td>
                                        <td>3 members</td>
                                        <td>Jun 12, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file me-2 font-24 text-primary"></i>
                                                </div>
                                                <div class="font-weight-bold text-primary">Landing Page Structure</div>
                                            </div>
                                        </td>
                                        <td>10 members</td>
                                        <td>Jul 17, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div><i class="bx bxs-file-doc me-2 font-24 text-success"></i>
                                                </div>
                                                <div class="font-weight-bold text-success">Review Checklist Template</div>
                                            </div>
                                        </td>
                                        <td>7 members</td>
                                        <td>Sep 8, 2019</td>
                                        <td><i class="fa fa-ellipsis-h font-24"></i>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <link rel="stylesheet" href="./assets/css/file_explorer.css">
    
    
    <script src="./assets/js/api_calls.js"></script>
    <script src="./assets/js/cookie_management.js"></script>
    <script>
        var login_message = undefined;
        var loginForm = undefined;
        var schedulerForm = undefined;
        var login_container = undefined;
        var file_explorer_container = undefined;
        var apiCall = new ApiCalls("/");
        
        function displayLoginMessage(message, type="replace") {
            if (type == "append") {
                message = login_message.innerHTML +" "+message;
            }
            login_message.innerHTML = "";
            login_message.innerHTML = message;
        }
    </script>
    <script>
        function setupFileExplorer() {
            let username = getCookie("username");
            let username_element = document.getElementById("hi_username");
            username_element.innerHTML = username;
            username_element.style.textTransform = "capitalize";
        }

        function uploadFiles() {
            let upload_modal = document.getElementById("file_upload_modal");
            upload_modal.style.display = "block";
        }
    </script>
    <script>
        
        loginForm = document.getElementById("loginForm");
        login_container = document.getElementById("login_container");
        file_explorer_container = document.getElementById("file_explorer_container");
        
        function login_success() {
            loginForm.style.display = "none";
            loginForm.reset();
            login_container.style.display = "none";
            file_explorer_container.style.display = "block";
        }
        
        function doAfterValidate(response) {
            response = JSON.parse(response);
            let isValid = true;
            if (!response["status"]) {
                displayLoginMessage("Login Failed: "+response["message"]);
                isValid = false;
            } 
            
            let validation_type = response["data"]["validation_type"];
            
            if (isValid && validation_type == "api_key") {
                login_success();
                setupFileExplorer();
            } else if (isValid && validation_type == "password") {
                displayLoginMessage("Successfully logged in.");
                setCookie("username", response["data"]["username"]);
                setCookie("api_key", response["data"]["apiKey"]);
                login_success();
                setupFileExplorer();
                
            } else {
                if (validation_type == "password") {
                    displayLoginMessage("Please check your usename or passowrd.")
                } else if (validation_type == "api_key"){
                    displayLoginMessage("Looks like your api key expired or is changed.")
                } else {
                    displayLoginMessage("Please login to continue.")
                }
            }
        }
        
        function validateLogin(form = false) {
            let postOb = {};
            
            displayLoginMessage("Attemptig autologin.");
            
            if (form) {
                let username = document.getElementById("username").value;
                let password = document.getElementById("password").value;
                if (!username && !password) {
                    displayLoginMessage("Please enter username and password.");
                    return
                }
                postOb = {"username":username, "password":password};
                
                apiCall.postData("fm/login/",{"Content-Type":"application/json"},[], postOb, doAfterValidate)
            } else {
                let username = getCookie("username");
                let api_key = getCookie("api_key");
                
                console.log(username, api_key);
                
                if (!username && !api_key) {
                    displayLoginMessage("Please login to continue.")
                    // console.log("No username and/or api key in cookies");
                    login_container.style.display = "block";
                    loginForm.style.display = "block";
                    file_explorer_container.style.display = "none";
                    return
                }
                postOb = {"username":username, "api_key":api_key};
                apiCall.postData("fm/isValid/",{"Content-Type":"application/json"},[], postOb, doAfterValidate)
            }
            
        }
        
        function login() {
            validateLogin(true);
        }
        
        function logout() {
            deleteCookie("username");
            deleteCookie("api_key");
            validateLogin();
            // apiCall.postData("scheduler/auth/user/logout",{"Content-Type":"application/json"},[], postOb, doAfterValidate);
        }
        
        var init = function () {
            
            
            fb_login_button = document.getElementById("fb_login_button");
            fb_logout_button = document.getElementById("fb_logout_button");
            login_message = document.getElementById("login_message");
            fbPagesList = document.getElementById("fbPagesList");
            igPagesList = document.getElementById("igPagesList");
            
            login_container.style.display = "block";
            file_explorer_container.style.display = "none";
            
            validateLogin();
        };
    </script>
    <script>
        (function () {
            init(); 
        })();
    </script>
</body>
</html>